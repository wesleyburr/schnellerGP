<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>schnellerGP: Installation and Performance • schnellerGP</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="schnellerGP: Installation and Performance">
<meta property="og:description" content="schnellerGP">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">schnellerGP</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/installation.html">schnellerGP: Installation and Performance</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="installation_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>schnellerGP: Installation and Performance</h1>
                        <h4 data-toc-skip class="author">Wesley S. Burr<sup>1</sup>
</h4>
            
      
      
      <div class="hidden name"><code>installation.Rmd</code></div>

    </div>

    
    
<p><sup>1</sup> Department of Mathematics, Trent University, Peterborough, ON, Canada</p>
<div class="section level1">
<h1 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h1>
<p>The schnellerGP package contains interfaces to a source library (in C++): HODLRlib, which “is a library consisting of fast matrix operations for matrices based on the Hierarchical Off-Diagonal Low-Rank (HODLR) structure.” As such, the package works best when given access to OpenMP and a good BLAS (i.e., not the default shipping) library. As such, the installation for best performance can be quite a bit trickier than a standard R package, as while the install.packages() step <strong>will</strong> install the package, it will not perform to expectations without more work.</p>
<p>This vignette goes through the process of configuring your environment for the installation of the package, for five different operating system frameworks: Windows 7, Windows 10, Ubuntu 20.04, Fedora 35, and Mac OSX, with that last discussed for both Intel and M1 (Mac) chipsets.</p>
</div>
<div class="section level1">
<h1 id="windows-10">Windows 10<a class="anchor" aria-label="anchor" href="#windows-10"></a>
</h1>
<p><strong>Note</strong>: Using Windows with a) compiled code; b) high performance requirements; c) linear algebra is basically a pain.</p>
<p>For Windows, because packages are not as easily installed as, say, a Linux operating system, the instructions are somewhat more complex. Note that these instructions are only for installing the <strong>latest</strong> version of schnellerGP from <strong>source</strong> - compiled Windows binaries can gloss over most of these issues. Unfortunately, this takes work, and we won’t always have the latest versions available. Note that no significant differences have been observed for installing this package on either Windows 7 or 10; Windows 11 has not been tested at this time.</p>
<p>Start by ensuring you have the latest version of <strong>R tools</strong> installed for your version of R. Testing has been done against R 4.1 and later, but not on R 3.5 or 3.6. This can be found on <a href="CRAN">https://cran.r-project.org/bin/windows/Rtools/</a>, as with the R interpreter and interface. Generally speaking, Rtools provides a miniaturized Linux environment and compiler-linker chain for Windows, based on a system called MinGW. Because of this, once you install Rtools there will be a link in your Start Menu under Rtools 4.0 for <strong>Rtools MinGW 64-bit</strong>. If you click this, you will get a terminal in the environment that R uses for compiling packages from source.</p>
<p>There is a note in the Rtools installation guidelines on CRAN, which states that</p>
<pre><code>After installation is complete, you need to perform one more step to be able to compile R 
packages: you need to put the location of the Rtools make utilities (bash, make, etc) on the 
PATH. The easiest way to do so is create a text file .Renviron in your Documents folder which 
contains the following line:
 
PATH="${RTOOLS40_HOME}\usr\bin;${PATH}"

If you then restart R, you can verify that make can be found, which should show the path to 
your Rtools installation:


```r
Sys.which("make")
```</code></pre>
<p>Make sure that you name the file <strong>.Renviron</strong> exactly, and not something like <strong>.Renviron.txt</strong>, which will not work. Since you’re already in R to test the above command, also install the required packages:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Rcpp"</span>, <span class="st">"RcppEigen"</span>, <span class="st">"RcppArmadillo"</span>, <span class="st">"knitr"</span>, <span class="st">"rmarkdown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="optimized-blas">Optimized BLAS<a class="anchor" aria-label="anchor" href="#optimized-blas"></a>
</h2>
<p>The precompiled R distribution that you likely downloaded and installed on your Windows machine is called the <strong>reference BLAS</strong>, and is designed to be very, very stable and cross-platform compatible, but not particularly optimized for performance. Significant improvements in almost all linear algebra operations can be observed by installing more optimized libraries. Given the use of HODLRlib, which is optimized for Intel Math Kernel Library (MKL), if you are planning on running any serious code with this package on Windows, you really need to update your BLAS. However, doing this on Windows is <strong>really</strong> hard. The Intel MKL compilers do not match with those needed to compile R from source, so there is no easy way to link in the MKL without some shenanigans.</p>
<p>Before you begin, you can use the <strong>sessionInfo</strong> in R to check which version you are running:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>You will see something like</p>
<pre><code>Matrix products: default</code></pre>
<p>if you are running the default BLAS library, and do not have a custom LAPACK installed. This indicates that you will benefit from the change suggested here. It is probably worth grabbing a benchmark script before you start, to verify that the changes have actually given some speedup. One <a href="set%20of%20good%20examples">https://mac.r-project.org/benchmarks/</a> is from Simon Urbanek’s old site, even if they are a bit dated. Using Option 2 or 3 below results in a minimum of a 5x speedup on many operations; the increases can be even more for certain classes of matrix operations.</p>
<div class="section level3">
<h3 id="option-1-install-mkl-manually-move-libraries">Option 1: Install MKL, Manually Move Libraries<a class="anchor" aria-label="anchor" href="#option-1-install-mkl-manually-move-libraries"></a>
</h3>
<p>The Intel MKL library is included as part of the <a href="Intel%20oneAPI%20Base%20Toolkit">https://www.intel.com/content/www/us/en/developer/tools/oneapi/onemkl.html</a>, which is freely available for download. This framework included BLAS and LAPACK operations, sparse linear algebra functions, Fast Fourier Transforms, and other functions which to some extent may be used by R to do statistical modeling. If you go to the provided link, and choose the Offline Installer, it is 3.5GB in size compressed (and 26GB fully installed), but can be downloaded once and installed, and then (likely) never touched again. The <strong>Online</strong> version is only 13.4MB, but then will download what you need dynamically after installation. This is still multiple gigabytes of space (6.8GB if you only select the MKL and nothing else).</p>
<p>Download the oneAPI Base Toolkit, and install at least the MKL on your computer. Then, navigate to your R program directory, typically in</p>
<pre><code>C:\Program Files\R\R-4.1.2\bin\x64</code></pre>
<p>and copy all of the contents of the mkl folder, typically in</p>
<pre><code>C:\Program Files (x86)\Intel\oneAPI\mkl\latest\redist\intel64\</code></pre>
<p>to your R bin directory. Within the latter, find the files named <strong>Rblas.dll</strong> and <strong>Rlapack.dll</strong> and rename them to <strong>Rblas.bak</strong> and <strong>Rlapack.bak</strong>. Note that you will need file extensions visible in your Windows Explorer to be able to do this properly (click <strong>View</strong> then check the box for File name extensions). Now, take the file <strong>mkl_rt.dll</strong> which should have copied over along with the rest of the Intel files, and copy it twice, still within the bin directory. Rename the first to <strong>Rblas.dll</strong>, and the second to <strong>Rlapack.dll</strong>. Restart R or RStudio if you have it open, and when you run <strong>sessionInfo()</strong>, your information should have updated.</p>
<p><strong>NOTE</strong>: this doesn’t currently work well. The oneAPI is a bit different to the original MKL installer, for which this was a good drop-in solution.</p>
</div>
<div class="section level3">
<h3 id="option-2-microsoft-r-open-now-deprecated">Option 2: Microsoft R Open (Now Deprecated)<a class="anchor" aria-label="anchor" href="#option-2-microsoft-r-open-now-deprecated"></a>
</h3>
<p>The <strong>easiest</strong> way to get improved performance in R on Windows was to simply install <a href="Microsoft%20R%20Open">https://mran.microsoft.com/rro</a>. This was an open source fork of R (currently 4.0.2 as of January, 2022) which has been optimized to use the Intel MKL and other, related performance libraries. It also, less fortunately, comes with a customized, snapshotted CRAN, which while fast, is not updated in between releases of Microsoft R Open. In addition, this program has been deprecated as of June 2021, and will no longer be updated moving forward, making it a poor overall choice. However, for now, R 4.0.2 isn’t <strong>that</strong> old, so this is a nice easy fix if you just need some speed for now.</p>
<p>All you need to do is run <a href="RStudio">https://www.rstudio.com/products/rstudio/download/</a>, install Microsoft R Open, and then switch which R you are using within RStudio when you want to work on linear algebra applications. In RStudio, under <strong>Global Options, General</strong> you can specify which R version you wish to use - if you restart RStudio after installing Microsoft R Open, it will appear as one of your options. You may find it suitable for everyday use, in which case you won’t be able to easily update your CRAN packages to the latest and greatest, but you will have extremely fast linear algebra libraries on the back end. Note that if you run</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>you will not see any particular information about your BLAS library, but if you are referencing the R version provided by Microsoft R Open (4.0.2, currently), it will be using the correct, higher performance libraries.</p>
</div>
<div class="section level3">
<h3 id="option-3-microsoft-r-open-just-the-libraries">Option 3: Microsoft R Open, Just the Libraries<a class="anchor" aria-label="anchor" href="#option-3-microsoft-r-open-just-the-libraries"></a>
</h3>
<p>Repeat option 2, install Microsoft R Open, even if deprecated, then take three files:</p>
<pre><code>C:\Program Files\Microsoft\R Open\R-4.0.2\bin\x64\libiomp5md.dll
C:\Program Files\Microsoft\R Open\R-4.0.2\bin\x64\Rblas.dll
C:\Program Files\Microsoft\R Open\R-4.0.2\bin\x64\Rlapack.dll</code></pre>
<p>and copy them to your</p>
<pre><code>C:\Program Files\R\R-4.1.2\bin\x64\</code></pre>
<p>directory. This does violate the Microsoft R Services MKL license, as it separates the MKL out of Microsoft R Open, but it’s a solution which gets you the speed if you also need to continue using Microsoft R Open past its deprecation.</p>
</div>
</div>
<div class="section level2">
<h2 id="install-schnellergp-from-source">Install schnellerGP from Source<a class="anchor" aria-label="anchor" href="#install-schnellergp-from-source"></a>
</h2>
<p>Now that you have an updated BLAS library installed, proceed to install <strong>schnellerGP</strong> by installing from the source tar.gz file - either type out the following (assuming your download is in the current working directory), or use the Install Packages interface in RStudio to point to the correct file.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"schnellerGP_0.1.0.tar.gz"</span>, type <span class="op">=</span> <span class="st">"source"</span>, repo <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<p>If the package compiles successfully, you can then load it in the usual way, and proceed with your modeling!</p>
</div>
</div>
<div class="section level1">
<h1 id="windows-7">Windows 7<a class="anchor" aria-label="anchor" href="#windows-7"></a>
</h1>
<p>The instructions for Windows 7 are the same as Windows 10, except you cannot install Microsoft R Open, as it does not support Windows 7 any more. Thus, while you can install Rtools, and install <strong>schnellerGP</strong>, it will not perform well. We strongly encourage the upgrade to a more recent operating system (Windows 10 is 7 years old as of 2022; Windows 7 is 13 years old!).</p>
</div>
<div class="section level1">
<h1 id="ubuntu-desktop-20-04">Ubuntu Desktop 20.04<a class="anchor" aria-label="anchor" href="#ubuntu-desktop-20-04"></a>
</h1>
</div>
<div class="section level1">
<h1 id="fedora-desktop-35">Fedora Desktop 35<a class="anchor" aria-label="anchor" href="#fedora-desktop-35"></a>
</h1>
<p>Assuming you have a working installation of Fedora (tested on 34 and 35), you should have installed a few background applications:</p>
<div class="section level2">
<h2 id="optimized-blas-1">Optimized BLAS<a class="anchor" aria-label="anchor" href="#optimized-blas-1"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="fu">sudo</span> dnf install R blas blas-devel R-flexiblas pandoc</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a><span class="ex">dnf</span> config-manager --add-repo https://yum.repos.intel.com/mkl/setup/intel-mkl.repo</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a><span class="ex">rpm</span> --import https://yum.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS-2019.PUB</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a><span class="ex">dnf</span> install intel-mkl</span></code></pre></div>
<p>Once this is done, if you launch an R session, you should be able to dynamically change your BLAS library at will. For example,</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Enchufa2/r-flexiblas" class="external-link">flexiblas</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/flexiblas/man/flexiblas-backends.html" class="external-link">flexiblas_load_backend</a></span><span class="op">(</span><span class="st">"/opt/intel/mkl/lib/intel64/libmkl_rt.so"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/flexiblas/man/flexiblas-backends.html" class="external-link">flexiblas_list_loaded</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>[1] “OPENBLAS-OPENMP”<br>
[2] “/opt/intel/mkl/lib/intel64/libmkl_rt.so”</p>
<p>Note that OpenBLAS is still a great package, and for many operations, is actually faster than Intel’s MKL (e.g., matrix products). However, as HODLRlib works best with MKL, this is why we recommend it be present.</p>
<p>In addition, the <strong>schnellerGP</strong> package depends on several R dependencies. You will need the following (knitr and rmarkdown are to allow the vignettes to be installed):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Rcpp"</span>, <span class="st">"RcppEigen"</span>, <span class="st">"RcppArmadillo"</span>, <span class="st">"knitr"</span>, <span class="st">"rmarkdown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Once you have ensured the dependencies are available, the installation is straightforward. From within R, you can run:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"schnellerGP_0.1.1.tar.gz"</span>, type <span class="op">=</span> <span class="st">"source"</span>, repo <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<p>or from the command line,</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="ex">R</span> CMD INSTALL schnellerGP_0.1.1.tar.gz</span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="mac-osx-10-">Mac OSX 10.??<a class="anchor" aria-label="anchor" href="#mac-osx-10-"></a>
</h1>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Matt Wheeler.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
