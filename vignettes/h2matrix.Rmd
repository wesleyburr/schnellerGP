---
title: "schnellerGP: H2-matrix Functionality"
author: Matthew Wheeler^1^, Kelly R. Moran^2^ and Wesley S. Burr^3^
output: 
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 1
    df_print: kable
    number_sections: true
vignette: >
  %\VignetteIndexEntry{schnellerGP: H2-matrix Functionality}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

^1^ Biostatistics & Computational Biology Branch, National Institute of Environmental Health Sciences, NIH, Durham, NC, USA

^2^ TBD

^3^ Department of Mathematics, Trent University, Peterborough, ON, Canada

# Introduction

The schnellerGP package contains two separate interfaces in three threads: 
access to the H2Lib library focused on H matrices; access to the H2lib
library focused on H$^2$ matrices; and access to the Hierarchical Off-Diagonal
Low-Rank (HODLR) library focused on fast linear algebra operations for matrices
formed in that way.

This vignette will explore the function interfaces developed for accessing
and working with H$^2$ matrices. 

---

# H$^2$ Matrices

## Description

In numerical analysis, hierarchical matrices (called *H-matrices*) are used as
data-sparse approximations of non-sparse matrices. This allows for representation
of sparse matrices of dimension $n$ in $\mathcal{O}(n)$ units of storage by 
storing only the non-zero entries, while non-sparse matrices would require
$\mathcal{O}(n^2)$ units. Hierarchical matrices provide an approximation to sparse 
matrices requiring only $\mathcal{O}(n k \log(n))$ units of storage, with $k$ being
a parameter controlling the accuracy of the approximation.

In order to scale to even larger problems, the structure of H-matrices has been
improved with the development of H$^2$ matrices. These replace the low-rank structure
of the blocks of an H-matrix with a further hierarchical representation, lowering
the storage complexity to $\mathcal{O}(nk)$. Arithmetic operations like we may
be interested in (e.g., multiplication, inversion, and Cholesky or LR factorization of H$^2$-matrices) can be implemented based on two fundamental operations: the matrix-vector multiplication with submatrices and the low-rank update of submatrices. 

The H2Lib library offers a state-of-the-art implementation of **hierarchical**
matrix techniques, and primarily for our interests, data structures for low-rank matrices, H-matrices, and H$^2$-matrices. 

## Basic Functionality

More wrappers have been implemented for working with $H^2$ matrices in
**schnellerGP**. We can create H$^2$ structured matrices with specific
kernels (our primary interest). The supported kernel types are
restricted to kernel_type


```{r}
library(schnellerGP)
A <- matrix(data = rnorm(200),
             nrow = 100,
             ncol = 2)
gp_h2 <- create_h2_kernel(X = as.matrix(A),
                          hp = as.matrix(c(16, 1), ncol = 1),
                          kt = 1)
```


* start with create_h2_kernel

then solve_h2_vector
solve_h2_vector_start

